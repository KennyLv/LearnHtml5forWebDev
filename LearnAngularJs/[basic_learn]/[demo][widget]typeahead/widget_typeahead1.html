<!DOCTYPE html><html>	<head>		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">		<title>Widget</title>		<meta name="author" content="Kenny">		<style>				</style>	</head>	<body ng-app="ymusica">		<div ng-controller='AlbumSearch'>			<h1>TypeAhead Using AngularJS</h1>						<typeahead>					<ul ng-repeat="artist in artists">							<li typeahead-item="artist">{{artist.name}}</li>					</ul>			</typeahead>					</div> 			<script type="text/javascript" src="../../assets/js/angular_1.2.25/angular.min.js"></script>		<script type="text/javascript" src="../../assets/js/angular_1.2.25/angular-resource.min.js"></script>		<script type="text/javascript" src="../../assets/js/rx.js"></script>		<script type="text/javascript">						angular.module('Rx', []).run(function() {					Rx.promiseToObservable = function(promise) {							var observable = new Rx.AsyncSubject();							promise.then(function(res) {									observable.onNext(res);									observable.onCompleted();							}, function(err) {									observable.onError(err);									observable.onCompleted();							});							return observable;					};			});									var app = angular.module('ymusica', ['ngResource','Rx']);						app.factory('albums', ['$http', function($http) {					return {							query: function(term) {									return $http.get('/api/album', { params: { q: term } });							}					};			}]);			app.factory('artists', ['$http', function($http) {					return {							query: function(term) {									return $http.get('/api/artist', { params: { q:term } });							}					};			}]);						app.controller('AlbumSearch', ['$scope', 'Albums', 'Artists', '$q', function($scope, albums, artists, $q) {					$scope.albums = [];					$scope.artists = [];					/*					var watchToObservable = function(scope, expression) {							var observable = new Rx.Subject();							scope.$watch(expression, observable.onNext.bind(observable));							return observable;					}					var functionToObservable = function(scope, name) {							var observable = new Rx.Subject();							scope[name] = function(value) {									observable.onNext(value);							};							return observable;					}					var terms = functionToObservable($scope, 'searchMusic');					*/										var terms = new Rx.Subject();										$scope.searchMusic = terms.onNext.bind(terms);										terms.sample(250)					.select(function(term) {							var promise = $q.all([albums.query(term), artists.query(term)]);							return Rx.promiseToObservable(promise)					})					.switchLatest()					.select(function(promise) { 							return [promise[0].data.albums, promise[1].data.artists]; 					})					.subscribe(function(result) {							$scope.albums = result[0].slice(0, 5);							$scope.artists = result[1].slice(0, 5);							$scope.music = $scope.albums.concat($scope.artists);					});										$scope.selectMusic = function(item) {							console.log('music selected!', item);							$scope.term = item.name;					};					$scope.imageSource = function(item) {							return item.images['medium'];					};					$scope.hasAlbums = function() {							return $scope.albums.length > 0;					};					$scope.hasArtists = function() {							return $scope.artists.length > 0;					};			}]);						app.directive('typeahead', ["$timeout", function($timeout) {					return {							restrict: 'E',							transclude: true,							replace: true,							template: '<div><form><input ng-model="term" ng-change="query()" type="text" autocomplete="off" /></form><div ng-transclude></div></div>',							scope: {									search: "&",									select: "&",									items: "=",									term: "="							},							controller: ["$scope", function($scope) {									$scope.items = [];									$scope.hide = false;									this.activate = function(item) {											$scope.active = item;									};									this.activateNextItem = function() {											var index = $scope.items.indexOf($scope.active);											this.activate($scope.items[(index + 1) % $scope.items.length]);									};									this.activatePreviousItem = function() {											var index = $scope.items.indexOf($scope.active);											this.activate($scope.items[index === 0 ? $scope.items.length - 1 : index - 1]);									};									this.isActive = function(item) {											return $scope.active === item;									};									this.selectActive = function() {											this.select($scope.active);									};									this.select = function(item) {											$scope.hide = true;											$scope.focused = true;											$scope.select({item:item});									};									$scope.isVisible = function() {											return !$scope.hide && ($scope.focused || $scope.mousedOver);									};									$scope.query = function() {											$scope.hide = false;											$scope.search({term:$scope.term});									}							}],							link: function(scope, element, attrs, controller) {									var $input = element.find('form > input');									var $list = element.find('> div');									$input.bind('focus', function() {											scope.$apply(function() { scope.focused = true; });									});									$input.bind('blur', function() {											scope.$apply(function() { scope.focused = false; });									});									$list.bind('mouseover', function() {											scope.$apply(function() { scope.mousedOver = true; });									});									$list.bind('mouseleave', function() {											scope.$apply(function() { scope.mousedOver = false; });									});									$input.bind('keyup', function(e) {											if (e.keyCode === 9 || e.keyCode === 13) {													scope.$apply(function() { controller.selectActive(); });											}											if (e.keyCode === 27) {													scope.$apply(function() { scope.hide = true; });											}									});									$input.bind('keydown', function(e) {											if (e.keyCode === 9 || e.keyCode === 13 || e.keyCode === 27) {													e.preventDefault();											};											if (e.keyCode === 40) {													e.preventDefault();													scope.$apply(function() { controller.activateNextItem(); });											}											if (e.keyCode === 38) {													e.preventDefault();													scope.$apply(function() { controller.activatePreviousItem(); });											}									});									scope.$watch('items', function(items) {											controller.activate(items.length ? items[0] : null);									});									scope.$watch('focused', function(focused) {											if (focused) {													$timeout(function() { $input.focus(); }, 0, false);											}									});									scope.$watch('isVisible()', function(visible) {											if (visible) {													var pos = $input.position();													var height = $input[0].offsetHeight;													$list.css({															top: pos.top + height,															left: pos.left,															position: 'absolute',															display: 'block'													});											} else {													$list.css('display', 'none');											}									});								}					};			}]);			app.directive('typeaheadItem', function() {					return {						require: '^typeahead',						link: function(scope, element, attrs, controller) {							var item = scope.$eval(attrs.typeaheadItem);							scope.$watch(function() { return controller.isActive(item); }, function(active) {									if (active) {											element.addClass('active');									} else {											element.removeClass('active');									}							});							element.bind('mouseenter', function(e) {									scope.$apply(function() { controller.activate(item); });							});							element.bind('click', function(e) {									scope.$apply(function() { controller.select(item); });							});						}					};			});		</script>	</body></html>