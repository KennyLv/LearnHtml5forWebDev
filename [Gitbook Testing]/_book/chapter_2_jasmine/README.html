<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <title>Chapter 2 jasmine | </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.0.3">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    
    <link rel="next" href="../chapter_2_jasmine/section_21_how_it_works.html" />
    
    
    <link rel="prev" href="../chapter_1_karma/README.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../gitbook/style.css">


        
    <div class="book"  data-level="2" data-basepath=".." data-revision="1425606830509">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="chapter_1_karma/README.html">
            
                
                    <a href="../chapter_1_karma/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         Chapter 1 Karma
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="2" data-path="chapter_2_jasmine/README.html">
            
                
                    <a href="../chapter_2_jasmine/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         Chapter 2 jasmine
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="2.1" data-path="chapter_2_jasmine/section_21_how_it_works.html">
            
                
                    <a href="../chapter_2_jasmine/section_21_how_it_works.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                         Section 2.1 How it works
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.2" data-path="chapter_2_jasmine/section_22_configuration_file.html">
            
                
                    <a href="../chapter_2_jasmine/section_22_configuration_file.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                         Section 2.2 Configuration File
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" ></a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_35">
                    
                        <h2 id="jasmine">jasmine介绍</h2>
<p>Jasmine是一个用来编写Javascript测试的框架，它不依赖于任何其它的javascript框架。</p>
<p>jasmine的结构很简单：</p>
<pre><code>describe(&quot;A suite&quot;, function() {
  var foo;
  beforeEach(function() {
    foo = 0;
    foo += 1;
  });

  afterEach(function() {
    foo = 0;
  });

  it(&quot;contains spec with an expectation&quot;, function() {
    expect(true).toBe(true);
  });
});
</code></pre><p>每个测试都在一个测试集中运行，Suite就是一个测试集，用describe函数封装。 Spec表示每个测试用例，用it函数封装。通过expect函数，作为程序断言来判断相等关系。setup过程用beforeEach函数封装，tearDown过程用afterEach封装。</p>
<p>用过Java中JUnit的同学，看到这种对应关系，应该就会明白jasmine就是JUnit的Javascript重写版。</p>
<h2 id="jasmine">jasmine安装</h2>
<p>安装jasmine类库时，让我们利用bower，一键搞定。bower的使用介绍，请参考文章：<a href="http://blog.fens.me/nodejs-bower-intro/" target="_blank">bower解决js的依赖管理</a>。</p>
<pre><code>#查找jasmine项目
~ D:\workspace\javascript\jasmine&gt;bower search jasmine

#安装jasmine类库
~ D:\workspace\javascript\jasmine&gt;bower install jasmine
</code></pre><h2 id="jasmine">jasmine环境配置</h2>
<p>jasmine运行需要4个部分：</p>
<ol>
<li>运行时环境：我们这里基于chrome浏览器，通过HTML作为javascript载体</li>
<li>源文件：用于实现某种业务逻辑的文件，就是我们平时写的js脚本</li>
<li>测试文件：符合jasmineAPI的测试js脚本</li>
<li>输出结果：jasmine提供了基于网页的输出结果</li>
</ol>
<p>下面让我开始jasmine：</p>
<pre><code># test.html

&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;jasmine test&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;bower_components/jasmine/lib/jasmine-core/jasmine.css&quot;&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;bower_components/jasmine/lib/jasmine-core/jasmine.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;bower_components/jasmine/lib/jasmine-core/jasmine-html.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;jasmine test&lt;/h1&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;src.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;test.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;report.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>我们看到页面上面有5个javascript的导入：</p>
<ul>
<li>jasmine.js：核心文件用于执行单元测试的类库</li>
<li>jasmine-html.js:用于显示单元测试的结果的类库</li>
<li>src.js:我们自己的业务逻辑的js</li>
<li>test.js:单元测试的js</li>
<li>report.js:用于启动单元测试js</li>
</ul>
<p>jasmine.js,jasmine-html.js是系统类库，直接引入。</p>
<p>src.js是实现业务逻辑的文件，我们定义sayHello的函数</p>
<pre><code># src.js

function sayHello(name){
    return &quot;Hello &quot; + name;
}
</code></pre><p>test.js对源文件进行单元测试</p>
<pre><code># test.js

describe(&quot;A suite of basic functions&quot;, function() {
    var name;
    it(&quot;sayHello&quot;, function() {
        name = &quot;Conan&quot;;
        var exp = &quot;Hello Conan&quot;;
        expect(exp).toEqual(sayHello(name));
    });
});
</code></pre><p><strong> report.js，是启动脚本，写法是固定的。</strong></p>
<pre><code># report.js

(function() {
    var jasmineEnv = jasmine.getEnv();
    jasmineEnv.updateInterval = 1000;

    var htmlReporter = new jasmine.HtmlReporter();

    jasmineEnv.addReporter(htmlReporter);

    jasmineEnv.specFilter = function(spec) {
        return htmlReporter.specFilter(spec);
    };

    var currentWindowOnload = window.onload;

    window.onload = function() {
        if (currentWindowOnload) {
            currentWindowOnload();
        }
        execJasmine();
    };

    function execJasmine() {
        jasmineEnv.execute();
    }

})();
</code></pre><blockquote>
<p>jasmine 2.0版本后用户不用再自己写启动文件了, 在jasmine的lib目录下自带有一个启动文件boot.js。</p>
</blockquote>
<h2 id="jasmine">jasmine使用</h2>
<p>1). 测试先行</p>
<p>测试先行，就是未写现实，先写用例。有一个需求，要实现单词倒写的功能。如：”ABCD” ==&gt; “DCBA” , 我们编辑test.js，增加一个测试用例</p>
<pre><code># test.js

it(&quot;reverse word&quot;,function(){
    expect(&quot;DCBA&quot;).toEqual(reverse(&quot;ABCD&quot;));
});
</code></pre><p>执行这个页面，单元测试失败，提示没有reverse函数。</p>
<p>2). 编辑src.js，增加reverse函数</p>
<pre><code>function reverse(name){
    return &quot;DCBA&quot;;
}
</code></pre><p>执行页面，单元测试成功！单元测试成功，是不是能说明我们完成了“单词倒写”的功能呢？答案是不确定的。如果想保证功能是正确性，我们需要进行更多次的验证。</p>
<p>3). 编辑test.js，继续增加测试用例</p>
<pre><code>it(&quot;reverse word&quot;,function(){
    expect(&quot;DCBA&quot;).toEqual(reverse(&quot;ABCD&quot;));
    expect(&quot;Conan&quot;).toEqual(reverse(&quot;nanoC&quot;));
});
</code></pre><p>刷新页面，又提示单元测试失败，因为我们希望输入是”Conan”，输出是”nanoC”，但是功能代码返回是”DCBA”，显然业务逻辑写的是不对的。</p>
<p>4). 修改src.js，修改reverse函数</p>
<pre><code>unction reverse(name){
    return name.split(&quot;&quot;).reverse().join(&quot;&quot;);
}
</code></pre><p>再次刷新页面，单元测试成功！！</p>
<p>这是敏捷开发中提倡的“测试先行”的案例，对于产品级的代码，我们真的应该要高质量控制。</p>
<h2 id="jasmine">jasmine语法实践</h2>
<p>以下内容是对jasmine语法的介绍，都在test.js中实现。做一个嵌套的describe(“A suite of jasmine’s function”)</p>
<p>学习Jasmine记住四个核心的概念即可：分组、用例、期望、匹配。四个核心概念分别对应Jasmine的四种函数，简要说明如下：</p>
<ol>
<li>describe(string,function)这个函数表示分组，也就是一组测试用例。</li>
<li>it(string,function)这个函数表示测试用例。</li>
<li>expect(expression)表示期望expression这个表达式具有某个值或者具有某种行为。</li>
<li>to<em>*</em>(arg)这个函数表示匹配。</li>
</ol>
<blockquote>
<p>对于同一组(describe)中的多个测试用例(it)，可以做一些重复性的动作，比如在每一个测试用例运行之前把某个变量+1等等。因此，Jasmine提供了beforeEach和afterEach两个函数，这也是为什么要有分组这个概念的原因。</p>
</blockquote>
<h4 id="">对断言表达式的使用</h4>
<pre><code>describe(&quot;A suite of jasmine&#39;s function&quot;, function() {
    describe(&quot;Expectations&quot;,function(){
        it(&quot;Expectations&quot;,function(){
            expect(&quot;AAA&quot;).toEqual(&quot;AAA&quot;);
            expect(52.78).toMatch(/\d*.\d\d/);
            expect(null).toBeNull();
            expect(&quot;ABCD&quot;).toContain(&quot;B&quot;);
            expect(52,78).toBeLessThan(99);
            expect(52.78).toBeGreaterThan(18);

            var x = true;
            var y;
            expect(x).toBe(true);
            expect(x).toBeDefined();
            expect(y).toBeUndefined();
            expect(x).toBeTruthy();
            expect(!x).toBeFalsy();

            var fun = function() { return a + 1;};
            expect(fun).toThrow();
        });
    });
});
</code></pre><h4 id="">对开始前和使用后的变量赋值</h4>
<pre><code>describe(&quot;Setup and Teardown&quot;,function(){
    var foo;
    beforeEach(function() {
        foo = 0;
        foo += 1;
    });
    afterEach(function() {
        foo = 0;
    });

    it(&quot;is just a function, so it can contain any code&quot;, function() {
        expect(foo).toEqual(1);
    });

    it(&quot;can have more than one expectation&quot;, function() {
        expect(foo).toEqual(1);
        expect(true).toEqual(true);
    });
});
</code></pre><h4 id="disabling-suites--suite">Disabling Suites : 对忽略suite的声明</h4>
<pre><code>xdescribe(&quot;Disabling Specs and Suites&quot;, function() {
    it(&quot;Disabling Specs and Suites&quot;,function(){
        expect(&quot;AAA&quot;).toEqual(&quot;AAA&quot;);
    });
});
</code></pre><h4 id="asynchronous-support--">Asynchronous Support : 对异步程序的单元测试</h4>
<pre><code>describe(&quot;Asynchronous Support&quot;,function(){
    var value, flag;
    it(&quot;Asynchronous Support&quot;, function() {
        runs(function() {
            flag = false;
            value = 0;
            setTimeout(function() {
                flag = true;
            }, 500);
        });
        waitsFor(function() {
            value++;
            return flag;
        }, &quot;The Value should be incremented&quot;, 750);

        runs(function() {
            expect(value).toBeGreaterThan(0);
        });
    });
});
</code></pre><p>我们成功地对Javascript完成各种的单元测试，下面是测试报告。</p>
<h2 id="todo-">TODO :</h2>
<ul>
<li>Custom equality</li>
<li>内置匹配函数与自定义匹配函数（Custom matcher）</li>
</ul>
<p>Spies</p>
<ul>
<li>Matching Anything with</li>
<li><p>Partial Matching with</p>
</li>
<li><p>Mocking the JavaScript Timeout Functions</p>
</li>
</ul>
<h2 id="jasmime">jasmime测试套件</h2>
<p>对于jQuery这种DOM操作的框架，有时难于分离view逻辑，以及ajax这种外部资源的mock，所以比较难于实施对jQuery程序的TDD开发。jasmine测试框架为了解决这些问题，开发了两个插件jasmine-jquery和jasmine-ajax。</p>
<h4 id="jasmine-jquery">jasmine-jquery</h4>
<p>jasmine-jQuery主要解决加载测试所需的DOM元素，为单元测试构建前置环境。</p>
<p>jasmine-jQuery加载DOM方法：</p>
<pre><code>jasmine.getFixtures().fixturesPath = &#39;base path&#39;;
loadFixtures(&#39;myfixture.html&#39;);
jasmine.getFixtures().load(...);
</code></pre><p>这里的loadFixtures需要真实ajax获取html fixtures所以我们需要提前host html fixtures。</p>
<p>jasmine-jQuery还框架了一些有用的matchers，如toBeChecked， toBeDisabled， toBeFocused，toBeInDOM……</p>
<h4 id="jasmine-ajax">jasmine-ajax</h4>
<p>jasmine-ajax则是对于一般ajax测试的mock框架，其从底层xmlhttprequest实施mock。</p>
<p>所以让我们能偶很容易实施对于jQuery的$.ajax,$.get... 的mock。</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../chapter_1_karma/README.html" class="navigation navigation-prev " aria-label="Previous page: Chapter 1 Karma"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../chapter_2_jasmine/section_21_how_it_works.html" class="navigation navigation-next " aria-label="Next page: Section 2.1 How it works"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
