<!DOCTYPE html><html><head>		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>		<title>Compile in Directive</title>		<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">		</head><body ng-app="testModule">		<a href="http://www.ifeenan.com/angularjs/2014-09-04-%5B%E8%AF%91%5DNG%E6%8C%87%E4%BB%A4%E4%B8%AD%E7%9A%84compile%E4%B8%8Elink%E5%87%BD%E6%95%B0%E8%A7%A3%E6%9E%90/" target="_blank">		[译]ng指令中的compile与link函数解析		</a>		<br/>		<a href="http://segmentfault.com/q/1010000000664866" target="_blank">		angular指令的compile的参数(tElement,tAttrs)和link中的参数(scope,iElement,iAttrs)究竟有什么区别?		</a>						<div ng-controller="ctrlOne">				<userinfo user="UserA"></userinfo>				<br/>				<userinfo user="UserB"></userinfo>		</div>		<hr/>		<div ng-controller="ctrlTwo">				<!--<input type="text" ng-model="UserA.firstName"/>-->				<div userinfo user="UserA"><span>test color :  {{UserA.color}}</span></div>				<br/>				<div userinfo user="UserB"></div>				<br/>				<input type="button" value="ChangeColor" ng-click="ChangeColor()"/>		</div>		<hr/>		<script type="text/javascript" src="../_Resource/angular_1.2.25/angular.min.js"></script>		<script type="text/javascript">				var myModule = angular.module("testModule", []).directive('userinfo', function () {						console.log("in zippy directive...");						return {								restrict : 'EA',								template : "<div>User : {{user.firstName}} {{user.lastName}} {{user.color}}<div ng-transclude></div></div>",								scope : {										user : "=user"								},								/*								当指令第一次被 AngularJS 编译的时候 (在 HTML 中第一次被发现)，compile() 函数被调用。								compile() 函数将为该元素做一次性配置。然后 compile() 函数以返回 link() 作为终结。								link() 函数将在每次元素被绑到 $scope 数据时，都被调用。								*/								/*								compile() 函数如果叫做 create(), init() 或者 configure()也许会更好。这样可以表达出这个函数只会被调用一次的意思。								而 link() 函数如果叫 bind() 或者 render() 也许会更好，能更好的表达出这样的意思，在指令绑定数据或者重绑定数据的时候，这个函数将会被调用。								*/								/*								compile函数有三个参数(tElement,tAttrs,linker),link函数有五个参数(scope,iElement,iAttrs,ctrl,linker)								*/								compile : function(element, attributes) {										console.log("call the compile fn...");										element.css("background-color","rgb(20, 197, 235)");																				var linkFunction = function(scope, element, atttributes,ctrl,linker){													console.log("call the linkFunction fn...");													if(scope.user.color){																element.css("background-color", scope.user.color);													}										}										return linkFunction;								},								/*								有时候你的指令可能不需要 compile() ,你只需要用到 link()。								这种情况下，你可以直接设置指令定义对象中的 link() 函数。								但是如果定义了compile()，无论其有没有返回link函数，link()都不会产生任何作用																*/								link : function(scope, element, attributes) {										console.log("call the link fn...");										element.html("<div>This is the new content : " + scope.user.firstName + "</div>");										element.css("background-color", "#000000");								},								transclude : true						};				}).controller("ctrlOne", function ($scope) {							console.log("in ctrl 1, set up the scope...");							$scope.UserA = { firstName : "UserA", lastName  : "In Ctrl 1" };							$scope.UserB = { firstName : "UserB", lastName  : "In Ctrl 1" };				}).controller("ctrlTwo", function ($scope) {							console.log("in ctrl 2, set up the scope...");							$scope.UserA = { firstName : "UserA", lastName  : "In Ctrl 2", color : "yellow" };							$scope.UserB = { firstName : "UserB", lastName  : "In Ctrl 2" };														$scope.ChangeColor = function(){									$scope.UserA.color="red";							}				});						</script></body></html>