<!DOCTYPE html><html>	<head>		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">		<title>demo</title>		<meta name="author" content="Kenny">			<style type="text/css">			  .css-form input.ng-valid.ng-dirty {				background-color: lightgreen;			  }			  .css-form input.ng-invalid.ng-dirty {					background-color: red;			  }			  .css-form input.ng-invalid.ng-pristine {					background-color: lightblue;			  }			  			</style>	</head>	<body ng-app="testDemoModule">		<p>form 通过novalidate/validate声明是否需要验证</p>		<p>通过required声明是否必须项</p>		<p>　				angular为大多数公共的HTML表单域（input，text,number,url,email,radio,checkbox）类型提供了实现，也有一些为了表单验证的directive（required，pattern,，inlength，maxlength，min，max）。				可以通过定义增加定制验证函数到ngModel controller（这里是连在一起的ngModelController吗？）中的directive来定义我们自己的验证插件。<br/>								为了得到一个controller，directive如下面的例子那样指定了依赖（directive定义对象中的require属性）。				<p>Model到View更新</p>				- 无论什么时候Model发生改变，所有在ngModelController.$formatters（当model发生改变时触发数据有效性验证和格式化转换）数组中的function将排队执行，			所以在这里的每一个function都有机会去格式化model的值，并且通过NgModelController.$setValidity（http://code.angularjs.org/1.0.2/docs/api/ng.directive:ngModel.NgModelController#$setValidity）修改控件的验证状态。				<p>View到Model更新</p>				- 一个相似的方式，无论任何时候，用户与一个控件发生交互，将会触发NgModelController.$setViewValue。				这时候轮到执行NgModelController$parsers（当控件从DOM中取得值之后，将会执行这个数组中所有的方法，对值进行审查过滤或转换，也进行验证）数组中的所有方法。				<p>在下面的例子中我们将创建两个directive。</p>				第一个是integer，它负责验证输入到底是不是一个有效的整数。例如1.23是一个非法的值，因为它包含小数部分。				注意，我们通过在数组头部插入（unshift）来代替在尾部插入（push），这因为我们想它首先执行并使用这个控件的值（估计这个Array是当作队列来使用的），我们需要在转换发生之前执行验证函数。				第二个directive是smart-float。他将”1.2”和”1,2”转换为一个合法的浮点数”1.2”。注意，我们在这不可以使用HTML5的input类型”number”，				因为浏览器不允许用户输入我们预期的非法字符，如”1,2”（它只认识”1.2”）。		</p>		<hr>		<div ng-controller="myFormCtrl">					<form novalidate class="css-form" name="formName">						<div>									大小(整数 0 - 10): <br/>									<input integer type="number" ng-model="size" name="size" min="0" max="10"/>{{size}} -- {{formName.size.$error}} <br/>									<span ng-show="formName.size.$error.invalided_integer">这不是一个有效的整数</span><br/>									<span ng-show="formName.size.$error.min || formName.size.$error.max"> 数值必须在0到10之间	 </span>						</div>						<br>						<div>							长度（浮点数）：<br/>							<input type="text" ng-model="length" name="length" smart-float/>{{length}} --  {{formName.length.$error}} <br/>							<span ng-show="formName.length.$error.invalided_float">这不是一个有效的浮点数</span>						</div>					</form>		</div>			<script type="text/javascript" src="../_Resource/angular_1.2.25/angular.min.js"></script>		<script type="text/javascript">						var INTEGER_REGEXP = /^\-?\d*$/;				var FLOAT_REGEXP = /^\-?\d+(?:[.,]\d+)?$/;								var app = angular.module("testDemoModule", []).directive("integer", function () {						return {							require:"ngModel",//NgModelController							link:function(scope,ele,attrs,ctrl) {								ctrl.$parsers.unshift(function (viewValue) {//$parsers，View到Model的更新									if(INTEGER_REGEXP.test(viewValue)) {										//合格放心肉										ctrl.$setValidity("invalided_integer", true);										return viewValue;									}else {										//私宰肉……										ctrl.$setValidity("invalided_integer", false);										return undefined;									}								});							}						};					}).directive("smartFloat", function () {						return {							require:"ngModel",							link:function(scope,ele,attrs,ctrl) {								ctrl.$parsers.unshift(function(viewValue) {									if(FLOAT_REGEXP.test(viewValue)) {										ctrl.$setValidity("invalided_float", true);										return parseFloat(viewValue.replace(",", "."));									}else {										ctrl.$setValidity("invalided_float", false);										return undefined;									}								});							}						}					}).controller('myFormCtrl', ['$scope',function($scope) {										}]);					</script>			</body></html>