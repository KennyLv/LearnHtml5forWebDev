<!DOCTYPE HTML><html lang="zh-cn"><head>		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">		<title>http cache demo</title>		<meta name="author" content="Kenny"></head><body ng-app="testApp"><div  ng-controller="PromisesWhenCtrl"></div>	<script type="text/javascript" src="../_Resource/angular_1.2.25/angular.min.js"></script><script type="text/javascript">		//http://blog.xebia.com/2014/02/23/promises-and-design-patterns-in-angularjs/		var app = angular.module('testApp', []);		app.controller("test1Ctrl", ['$q', function($q) {				function asyncGreet(name) {						var deferred = $q.defer();						setTimeout(function() {								deferred.notify('About to greet ' + name + '.');								if (name == "Holly Wood") {										deferred.resolve('Hello, ' + name + '!');								} else {										deferred.reject('Greeting ' + name + ' is not allowed.');								}						}, 1000);						return deferred.promise;				}								var promise = asyncGreet('HollyWood');				promise.then(function(greeting) {						console.log('Success: ' + greeting);				}, function(reason) {						console.log('Failed: ' + reason);				}, function(update) {						console.log('Got notification: ' + update);				});						}]);				app.controller("test2Ctrl", ['$q', '$interval', function($q,$interval) {				var deferred = $q.defer();				var promise = deferred.promise;								promise.then(function onSuccess(data) {						console.log('then 1 succeed:', data);				},function onError(data) {						console.log('then 1 failed:', data);				},function onNotify(data) {						console.log('then 1 notification:', data);				});								var progress = 0;				var interval = $interval(function() {						if (progress >= 100) {								$interval.cancel(interval);								deferred.resolve("Oh look we're done already.");	// deferred.reject("We failed :( ");						}						progress += 10;						deferred.notify("In progress : " + progress + '%...');				}, 600);								promise.then(function (data) {						console.log('then 2 succeed:', data);				},function (data) {						console.log('then 2 failed:', data);				},function (data) {						console.log('then 2 notification:', data);				}).catch(function error(msg) {						console.error(msg);				});		}]);		app.controller("ChainingPromises1Ctrl", ['$q', function($q) {				var deferred = $q.defer();				var promise = deferred.promise;								promise.then(function(val) {						console.log("1: " + val);						return 'return B in 1 ...';				})				.then(function(val) {						console.log("2: " + val);						return 'return C in 2 ...';				})				.then(function(val) {						console.log("3: " + val);				});								deferred.resolve("return A when done ...");			}]);				app.controller("ChainingPromises2Ctrl", ['$q', '$timeout', function($q,$timeout) {				var deferred = $q.defer();				var promise = deferred.promise;				// resolve it after a second				$timeout(function() {						deferred.resolve('foo');				}, 1000);				promise.then(function(one) {						console.log('Promise one resolved with ', one);						var anotherDeferred = $q.defer();						// resolve after another second						$timeout(function() {								anotherDeferred.resolve('bar');						}, 1000);						return anotherDeferred.promise;				}).then(function(two) {						console.log('Promise two resolved with ', two);				});		}]);				app.controller("ParallelPromisesCtrl", ['$q', '$timeout', function($q,$timeout) {				var deferred1 = $q.defer();				var promiseOne = deferred1.promise;				var deferred2 = $q.defer();				var promiseTwo = deferred2.promise;				var deferred3 = $q.defer();				var promiseThree = deferred3.promise;								// resolve it after a second				$timeout(function() {						console.log("deferred1 resolved");						deferred1.resolve('deferred1');				}, 500);				$timeout(function() {						console.log("deferred3 resolved");						deferred3.resolve('deferred3');				}, 1200);				$timeout(function() {						console.log("deferred2 resolved");						deferred2.resolve('deferred2');				}, 2300);				$q.all([promiseOne, promiseTwo, promiseThree]).then(function(results) {						console.log(results[0], results[1], results[2]);				});				$q.all({ first: promiseOne, second: promiseTwo, third: promiseThree }).then(function(results) {						console.log(results.first, results.second, results.third);				});						}]);				app.service('MyService', ['$q', '$timeout', function($q,$timeout) {				var deferred = $q.defer();				var aPromise = deferred.promise;								var cachedSomething;				this.getSomething = function() {						if (cachedSomething) {								console.log("return cache...");								return $q.when(cachedSomething);						}						$timeout(function() {								console.log("deferred resolved");								deferred.resolve('deferred');						}, 2000);						// on first call, return the result of MyResource.get()						// note that 'then()' is chainable / returns a promise,						// so we can return that instead of a separate promise object						return aPromise.then(function(something) {								console.log("return pormise..." + something);								cachedSomething = something;						});				};		}])/*.service('BarResource', function ($resource) {				return $resource('api/bar/:id');		}).service('BarService', function (BarResource) {				this.getBar = function (id) {						return BarResource.get({								id: id						}).$promise;				}		})*/;				app.controller("PromisesWhenCtrl", ['MyService', function(MyService) {				/*				var deferred = $q.defer();				var aPromise = deferred.promise;				var valueOrPromise = 'this value was already here...';								$timeout(function() {						console.log("deferred resolved");						deferred.resolve('deferred');				}, 1200);												aPromise.then(function(val) {						console.log("resolved in aPromise.then :  " + val);				});				$q.when(aPromise).then(function(val) {						console.log("resolved in $q when aPromise :  " + val);				});								$q.when(valueOrPromise).then(function(val) {						console.log(val);				});				*/								MyService.getSomething().then(function(something) {						console.log("in controller then: " + something);				});						}]);		/*		app.controller('CheckoutCtrl', function($scope, $log, CustomerService, CartService, CheckoutService) {				function calculateTotals(cart) {						cart.total = cart.products.reduce(function(prev, current) {								return prev.price + current.price;						};						return cart;				}				CustomerService.getCustomer(currentCustomer)				.then(CartService.getCart) // getCart() needs a customer object, returns a cart				.then(calculateTotals)				.then(CheckoutService.createCheckout) // createCheckout() needs a cart object, returns a checkout object				.then(function(checkout) {						$scope.checkout = checkout;				})				.catch($log.error)		});		*/		</script></body></html>