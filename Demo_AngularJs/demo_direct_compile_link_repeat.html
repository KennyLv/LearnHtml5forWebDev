<!DOCTYPE html><html><head>		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>		<title>Compile in Directive</title>		<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">		</head><body ng-app="testModule">		<a href="http://www.ifeenan.com/angularjs/2014-09-04-%5B%E8%AF%91%5DNG%E6%8C%87%E4%BB%A4%E4%B8%AD%E7%9A%84compile%E4%B8%8Elink%E5%87%BD%E6%95%B0%E8%A7%A3%E6%9E%90/" target="_blank">		[译]ng指令中的compile与link函数解析		</a>		<br/>		<a href="http://segmentfault.com/q/1010000000664866" target="_blank">		angular指令的compile的参数(tElement,tAttrs)和link中的参数(scope,iElement,iAttrs)究竟有什么区别?		</a>		<!--		<script type="text/ng-template" id="text.html">				<div><h3 ng-transclude></h3></div>		</script>		-->		<div ng-controller="testCtrl"  id="testCtrl" >				<div cb-repeat="thing in things">								<my-widget> {{thing.name}}  coss ${{thing.p}}</my-widget>								<input type="button" value="removeThis" ng-click="removeThis(thing.index)"/>				</div>				<br/>				<input type="button" value="removeOne" ng-click="removeOne()"/>				<br/>				{{things}}		</div>		<hr/>		<div ng-controller="testCtrlOne"  id="testCtrlOne" >				<div cb-repeat="color in colors">								<span>{{color}}</span>				</div>		</div>		<script type="text/javascript" src="../_Resource/angular_1.2.25/angular.min.js"></script>		<script type="text/javascript">				var myModule = angular.module("testModule", [])				.directive('cbRepeat',function(){						return {								restrict:'EAC',								transclude:'element',								compile:function(tEle,tAttrs,trans){											console.log('cbRepeat  compile');											return function(scope,iEle,iAttrs,ctrl,linker){															console.log('cbRepeat post');																														var myLoop = iAttrs.cbRepeat, match = myLoop.match(/\s*(.+)\s+in\s+(.*)\s*/), indexString = match[1], collectionString = match[2];															//console.log("myLoop is : "           + myLoop);															//console.log("indexString is : "      + indexString);															//console.log("collectionString is : " + collectionString);																														var parentEle = iEle.parent(), elements = [];															console.log("parentEle is : ");															console.log(parentEle);																														scope.$watchCollection(collectionString,function(collection){																					if(elements.length>0){																								for(var i= 0;i<elements.length;i++){																											elements[i].el.remove();																											elements[i].scope.$destroy();																								}																								elements = [];																					}																					for(var i=0;i<scope[collectionString].length;i++){																								//console.log(scope.$new().$parent==scope);																								//scope.$new()创建一个作用域的子作用域																								var newScope = scope.$new(); 																								newScope[indexString] = scope[collectionString][i];																								//																								newScope[indexString].index = i; 																								//跟Scope绑定																								linker(newScope,function(clone){																												parentEle.append(clone);																												var element = {};																												element.el = clone;																												element.scope = newScope;																												element.scope.$on('$destroy',function(){																																//console.log('removed');																												});																												elements.push(element);																								});																					}															});											}								}						}				}).directive('myWidget',function(){							return {								restrict:'E',								//templateUrl:'text.html',								template: '<span><h1 ng-transclude></h1></span>',								replace:true,								transclude:true,								scope:true,								compile:function(tEle,tAttrs,trans){										console.log('myWidget compile : '+ tEle.html());										return function(scope,iEle,iAttrs){													console.log('myWidget post : '+ iEle.html())										}								}        							}				}).controller("testCtrl", function ($scope) {							console.log("in testCtrl, set up the scope...");							$scope.things = [{"name":"UserA","p":"2.6"},{"name":"In Ctrl 2","p":"2.6"},{"name":"yellow","p":"2.6"}];							$scope.removeOne = function(){									$scope.things.shift();//$scope.things.pop();							}							$scope.removeThis = function(index){									$scope.things.splice(index,1);							}				}).controller("testCtrlOne", function ($scope) {							console.log("in testCtrlOne, set up the scope...");							$scope.colors = [{"key" : "r", "value" : "red" },{"value" : "In Ctrl 2"},{"c":"yellow"}];				});						</script></body></html>