<h1>AngularJS  的 -- <span style="color:red;">$Location</span> </h1><!--使用$locationhttp://angularjs.cn/A00MAngularJS中locationchange、routechange事件 http://blog.csdn.net/spy19881201/article/details/17096675--><section  ng-show="currentShow == '0'">		<p><strong>假设有这样一场景：在用户切换到另外一个route时，需要检查当前表单（内容）是否已保存，这个能不能在AngularJS中实现呢？</strong></p>		<h3>$route服务</h3>		<div style="background:white;margin:20px;line-height:24px;"> 			$route is used for deep-linking URLs to controllers and views (HTML partials). It watches $location.url() and tries to map the path to an existing route definition.  		</div>		<p>$route服务原来只是监视$location服务中某个数据变化的...</p>		<p><strong>顺藤摸瓜，来看看$location服务...</strong></p>				<h3>$location服务</h3>		<p>$location服务解析地址栏中的URL（基于window.location），让你在应用代码中能获取到。改变地址栏中的URL会反应$location服务中，反之亦然。你可以利用它：</p>		<p><strong>1，暴露当前地址栏的URL，这样你就能</strong></p>		<ul>			<li>获取并监听URL。</li>			<li>改变URL。</li>		</ul>		<p><strong>2，当出现以下情况时同步URL</strong></p>		<ul>			<li>改变地址栏。</li>			<li>点击了后退按钮（或者点击了历史链接）。</li>			<li>点击了一个链接。</li>		</ul>		<p><strong>3，一系列方法来获取URL对象的具体内容用（protocol, host, port, path, search, hash）</strong></p>				</section><section  ng-show="currentShow == '1'">		<p><strong>回到刚才的场景</strong></p>		<p>我们首先来分析下，场景中有那些事件流。</p>		<ol>			<li>用户编辑了表单</li>			<li>用户准备点击另外一个route url，触发提示‘是否要保存’</li>			<li>点击‘是’，route切换事件停止；点击‘否’，route切换事件继续</li>		</ol>		<p>主要流程就这些其实很简单。那么我们能否利用$route服务或者$location服务，根据url的变化来实现这个过程呢？</p>		<p>翻看API，找到了两个方法：</p>		<h3>$location - $locationChangeStart vs $route - $routeChangeStart</h3>		<div style="background:white;margin:20px;line-height:24px;"> 		<strong>$locationChangeStart - Broadcasted before a URL will change.</strong> <br/>		<span style="color:red;">This change can be prevented by calling preventDefault method of the event. </span><br/>		See $rootScope.Scope for more details about event object. Upon successful change $locationChangeSuccess is fired.		</div>				<div style="background:white;margin:20px;line-height:24px;"> 		<strong>$routeChangeStart - Broadcasted before a route change.</strong> At this point the route services starts resolving all of the dependencies needed for the route change to occur. Typically this involves fetching the view template as well as any dependencies defined in resolve route property. Once all of the dependencies are resolved $routeChangeSuccess is fired.		</div>				<p>route是监控location.url的，所以事件的触发应该是先location后route事件，验证一下:</p><pre>app.run(['$rootScope', '$window', '$location', '$log', function ($rootScope, $window, $location, $log) {  		var locationChangeStartOff = $rootScope.$on('$locationChangeStart', locationChangeStart);  		var locationChangeSuccessOff = $rootScope.$on('$locationChangeSuccess', locationChangeSuccess);  		var routeChangeStartOff = $rootScope.$on('$routeChangeStart', routeChangeStart);  		var routeChangeSuccessOff = $rootScope.$on('$routeChangeSuccess', routeChangeSuccess);  		function locationChangeStart(event) {  			$log.log('locationChangeStart');  		}		function locationChangeSuccess(event) {  			$log.log('locationChangeSuccess');  		}  		function routeChangeStart(event) {  			$log.log('routeChangeStart');  		}  		function routeChangeSuccess(event) {  			$log.log('routeChangeSuccess');  		}  }]);  </pre><p>我们只需要处理 locationChangeStart，我们利用location改变事件来实现了在提交Location之前做了定制化：</p><pre>function locationChangeStart(event, newUrl) {  		var ret = $window.confirm('Are you sure to give it up? ');  		if (ret) {  				locationChangeStartOff(); //Stop listening for location changes or you can do others  				$location.path(newUrl);  				return;  		}  		<strong style="color:red;">event.preventDefault();  </strong>		return;  }  </pre><p>而route事件是在URL改变之后发生，因此我们可以利用route事件做一些类似“loading...”的效果。</p><br/><br/><br/><br/></section><section  ng-show="currentShow == '2'">$location的双向绑定'$routeProvider', '$locationProvider',http://blog.fens.me/angularjs-url/</section><section  ng-show="currentShow == '3'">历史管理 vs 网络爬虫SEO</section>									